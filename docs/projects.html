<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Projects â€“ Tadeu Eder da Silva, PhD</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Tadeu Eder da Silva, PhD</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./projects.html" aria-current="page"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./videos.html"> 
<span class="menu-text">Videos</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=RsZ9F8gAAAAJ&amp;hl=en"> <i class="bi bi-mortarboard" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/tadeu-eder-da-silva-78b679181/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TEDS-91"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#completed-projects" id="toc-completed-projects" class="nav-link active" data-scroll-target="#completed-projects">âœ… Completed Projects</a>
  <ul class="collapse">
  <li><a href="#dairyprint-sustainability-systems-modeling" id="toc-dairyprint-sustainability-systems-modeling" class="nav-link" data-scroll-target="#dairyprint-sustainability-systems-modeling">DairyPrint: Sustainability &amp; Systems Modeling</a></li>
  <li><a href="#calfsim-milk-feeding-simulator" id="toc-calfsim-milk-feeding-simulator" class="nav-link" data-scroll-target="#calfsim-milk-feeding-simulator">CalfSim: Milk Feeding Simulator</a></li>
  <li><a href="#dairybrain-predictive-decision-support-tools" id="toc-dairybrain-predictive-decision-support-tools" class="nav-link" data-scroll-target="#dairybrain-predictive-decision-support-tools">DairyBrain: Predictive Decision Support Tools</a></li>
  </ul></li>
  <li><a href="#ongoing-projects" id="toc-ongoing-projects" class="nav-link" data-scroll-target="#ongoing-projects">ðŸš§ Ongoing Projects</a>
  <ul class="collapse">
  <li><a href="#portable-nir-calibration-urochloa-spp.-forage-quality-prediction" id="toc-portable-nir-calibration-urochloa-spp.-forage-quality-prediction" class="nav-link" data-scroll-target="#portable-nir-calibration-urochloa-spp.-forage-quality-prediction">Portable NIR Calibration: Urochloa spp. Forage Quality Prediction</a></li>
  <li><a href="#cotricalc-system-dairy-cost-estimation-system" id="toc-cotricalc-system-dairy-cost-estimation-system" class="nav-link" data-scroll-target="#cotricalc-system-dairy-cost-estimation-system">Cotricalc System: Dairy Cost Estimation System</a></li>
  <li><a href="#behavioral-monitoring-anomaly-detection-system-name-tbd" id="toc-behavioral-monitoring-anomaly-detection-system-name-tbd" class="nav-link" data-scroll-target="#behavioral-monitoring-anomaly-detection-system-name-tbd">Behavioral Monitoring &amp; Anomaly Detection System <em>(Name TBD)</em></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Projects</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="completed-projects" class="level2">
<h2 class="anchored" data-anchor-id="completed-projects">âœ… Completed Projects</h2>
<section id="dairyprint-sustainability-systems-modeling" class="level3">
<h3 class="anchored" data-anchor-id="dairyprint-sustainability-systems-modeling">DairyPrint: Sustainability &amp; Systems Modeling</h3>
<p><strong>Description:</strong><br>
A modeling tool developed to evaluate dairy farm management strategies, with a focus on <strong>greenhouse gas emissions</strong>, <strong>nutrient excretion</strong>, and overall sustainability. DairyPrint integrates key biological processes across the system and delivers tailored outputs to support decision-making on commercial dairy farms.</p>
<p><strong>Objective:</strong><br>
To support farmers, advisors, and researchers in exploring how different management strategies affect productivity and environmental outcomes in dairy systems.</p>
<p><strong>Outcomes:</strong><br>
- âœ… An interactive online tool for scenario simulation<br>
- âœ… A peer-reviewed publication describing model structure, functionality, and use cases<br>
- âœ… Additional resources including abstracts, scientific articles, and videos explaining how the model works</p>
<p>ðŸ”— <a href="https://dairymgt.cals.wisc.edu/tools.php#Environment">Online Model and Resources</a><br>
ðŸ“„ <a href="https://www.sciencedirect.com/science/article/pii/S002203022401049X">Journal Article (JDS, 2024)</a></p>
<hr>
</section>
<section id="calfsim-milk-feeding-simulator" class="level3">
<h3 class="anchored" data-anchor-id="calfsim-milk-feeding-simulator">CalfSim: Milk Feeding Simulator</h3>
<p><strong>Description:</strong><br>
CalfSim is a web-based simulation tool designed to help users create and evaluate customized milk feeding plans for dairy calves. Developed in <strong>R + Shiny</strong> and based on the nutrient requirements from <strong>NASEM (2021)</strong>, the tool models body weight gain, cost per kg of gain, and feeding strategies under various user-defined scenarios.</p>
<p><strong>Objective:</strong><br>
To support calf nutrition planning by enabling producers, consultants, and researchers to explore and compare the biological and economic outcomes of different liquid feeding strategies over time.</p>
<p><strong>Outcomes:</strong><br>
- âœ… An interactive tool to design milk plans for preweaned calves<br>
- âœ… Submitted manuscript to the <em>Journal of Dairy Science</em> describing methodology, structure, and applications<br>
- âœ… Complementary resources planned for training and on-farm application</p>
<p>ðŸ”— <a href="https://tadeuedersilva.shinyapps.io/calfsim/">Try CalfSim</a> ðŸ“„ Manuscript submitted to <em>Journal of Dairy Science</em> (under review)</p>
<hr>
</section>
<section id="dairybrain-predictive-decision-support-tools" class="level3">
<h3 class="anchored" data-anchor-id="dairybrain-predictive-decision-support-tools">DairyBrain: Predictive Decision Support Tools</h3>
<p><strong>Description:</strong><br>
DairyBrain is a research and extension initiative from UWâ€“Madison that aims to build real-time, data-driven decision support tools for dairy farms. The project integrates multiple on-farm data sourcesâ€”including sensors, software, and farm management systemsâ€”to support better decision-making through predictive analytics and visualization.</p>
<p><strong>Objective:</strong><br>
To develop scalable tools that transform complex dairy data into actionable insights, enabling more efficient, sustainable, and profitable farm management.</p>
<p><strong>Outcomes:</strong><br>
- âœ… Contributions to data engineering pipelines connecting sensor and herd management systems<br>
- âœ… Predictive models for milk yield, feed intake, and economic indicators<br>
- âœ… Development of real-time dashboards and data visualizations for on-farm use<br>
- âœ… Peer-reviewed publication detailing data engineering applications in livestock production</p>
<p>ðŸ”— <a href="https://www.sciencedirect.com/science/article/abs/pii/S1871141321002109">Published Article â€“ Livestock Science (2021)</a></p>
<hr>
</section>
</section>
<section id="ongoing-projects" class="level2">
<h2 class="anchored" data-anchor-id="ongoing-projects">ðŸš§ Ongoing Projects</h2>
<hr>
<section id="portable-nir-calibration-urochloa-spp.-forage-quality-prediction" class="level3">
<h3 class="anchored" data-anchor-id="portable-nir-calibration-urochloa-spp.-forage-quality-prediction">Portable NIR Calibration: Urochloa spp. Forage Quality Prediction</h3>
<p><strong>Description:</strong><br>
This project investigates how different preprocessing methods influence the prediction of <strong>dry matter (DM)</strong> and <strong>neutral detergent fiber (NDF)</strong> in <em>Urochloa spp.</em> forages using a <strong>handheld near infrared (NIR) spectrophotometer</strong>. Developed in partnership between the <strong>Universidade federal Rural do Rio de Janeiro (UFRRJ)</strong> and the <strong>University of Vermont</strong>, the project aims to improve forage analysis in tropical grazing systems through portable, field-ready technologies.</p>
<p><strong>Objective:</strong><br>
To enhance the accuracy and usability of portable NIR devices in predicting forage chemical composition under varying sample conditionsâ€”whether fresh, dried, or processedâ€”by identifying optimal preprocessing strategies.</p>
<p><strong>Outcomes:</strong><br>
- âœ… Determination of the most appropriate preprocessing approaches depending on forage sample type (fresh, dried, milled)<br>
- âœ… Generation of calibration curves for use in future on-farm applications</p>
<hr>
</section>
<section id="cotricalc-system-dairy-cost-estimation-system" class="level3">
<h3 class="anchored" data-anchor-id="cotricalc-system-dairy-cost-estimation-system">Cotricalc System: Dairy Cost Estimation System</h3>
<p><strong>Description:</strong><br>
Cotricalc is a modular decision-support system developed in collaboration with <strong>Cotrijal</strong>, one of the largest agricultural cooperatives in Brazil. Designed to meet the specific needs of its dairy producers, the system focuses on accurately calculating milk production costs at the farm level, offering a customizable, transparent, and practical approach to financial management.</p>
<p><strong>Objective:</strong><br>
To support Cotrijalâ€™s technical team and member farmers in tracking costs, margins, and resource allocation by providing a user-friendly platform built with <strong>R Shiny</strong> and integrated with <strong>Google Sheets</strong> for dynamic data entry and reporting.</p>
<p><strong>Outcomes:</strong><br>
- âœ… A fully functional and customizable milk production cost calculator<br>
- âœ… Built-in modules for different cost categories (e.g., feed, labor, reproduction, health, etc.)<br>
- âœ… Used as a technical and financial planning tool by Cotrijal technicians and dairy producers<br>
- âœ… Designed for scalability and future integration with benchmarking tools and dashboards</p>
<p>ðŸ”— Internal deployment under Cotrijalâ€™s technical extension program (in development)</p>
<hr>
</section>
<section id="behavioral-monitoring-anomaly-detection-system-name-tbd" class="level3">
<h3 class="anchored" data-anchor-id="behavioral-monitoring-anomaly-detection-system-name-tbd">Behavioral Monitoring &amp; Anomaly Detection System <em>(Name TBD)</em></h3>
<p><strong>Description:</strong><br>
A predictive monitoring system being developed in collaboration with <strong>Cotrijal Cooperative</strong> and <strong>CowMed</strong>, a Brazilian company specializing in dairy cow behavior monitoring through sensor-equipped collars. The system leverages high-frequency behavioral dataâ€”including <strong>rumination</strong>, <strong>feeding</strong>, and <strong>activity patterns</strong>â€”to detect anomalies and provide actionable insights for farm management.</p>
<p><strong>Objective:</strong><br>
To support technicians and producers in identifying early signs of health or management issues, and to promote timely interventions that improve animal welfare and farm productivity. The system is intended to be integrated into the daily technical routines used by Cotrijalâ€™s advisory teams.</p>
<p><strong>Outcomes:</strong><br>
- âœ… Predictive modeling using real-time data from CowMed collars<br>
- âœ… Detection of behavioral anomalies linked to health and performance deviations<br>
- âœ… Development of dashboards and alert systems to support day-to-day decisions<br>
- âœ… Customization for Cotrijalâ€™s operational structure and its member farms</p>
<p>ðŸ”— Internal development in partnership with Cotrijal and CowMed (underway)</p>
<hr>
<blockquote class="blockquote">
<p>This page is constantly updated with recent and ongoing work. If youâ€™d like to collaborate, feel free to reach out.</p>
</blockquote>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>